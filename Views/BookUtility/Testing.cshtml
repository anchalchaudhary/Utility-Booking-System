@model List<UtilityBookingSystem.Models.DetailsList>
@{
    ViewBag.Title = "Index";
}
<script src="~/Scripts/jquery-3.2.1.js"></script>

<div id="bookingForm" style="display:none;">
    @{
        int index = 0;
        int hall = 0, slot = 0, requirement = 0;
        //using (Html.BeginForm("Testing", "BookUtility", FormMethod.Post, new { @id = "regForm" }))
        //{
            <input type="date"  name="detailsObjList[@index].date" id="date" required onchange="datechosen();" />
            foreach (var item in ViewBag.HallDetail)
            {
                <hr />
                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].hallID" value="@(hall + 1)" id="hiddenhall@(hall)"/>
                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].hallName" value="@item.hallName" id="hiddenhallname@(hall)"/>
                <label>@item.hallName</label>
            <!--SLOTS-->
                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].slotsArray[@slot].slotID" value="@(slot + 1)" id="hiddenslot@(slot + 1)_@(hall + 1)_" />
                <label>SLOT 1</label>
                <input type="checkbox" name="detailsObjList[@index].hallsArray[@hall].slotsArray[@slot].isSelected" id="slotcheck@(slot + 1)_@(hall + 1)_" onchange="slotcheckchange(@(slot + 1), @(hall + 1));" />

                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].slotsArray[@(slot + 1)].slotID" value="@(slot + 2)" id="hiddenslot@(slot + 2)_@(hall + 1)_" />
                <label>SLOT 2</label>
                <input type="checkbox" name="detailsObjList[@index].hallsArray[@hall].slotsArray[@(slot + 1)].isSelected" id="slotcheck@(slot + 2)_@(hall + 1)_" onchange="slotcheckchange(@(slot + 2), @(hall + 1));" />

                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].slotsArray[@(slot + 2)].slotID" value="@(slot + 3)" id="hiddenslot@(slot + 3)_@(hall + 1)_" />
                <label>SLOT 3</label>
                <input type="checkbox" name="detailsObjList[@index].hallsArray[@hall].slotsArray[@(slot + 2)].isSelected" id="slotcheck@(slot + 3)_@(hall + 1)_" onchange="slotcheckchange(@(slot + 3), @(hall + 1));" />

                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].slotsArray[@(slot + 3)].slotID" value="@(slot + 4)" id="hiddenslot@(slot + 4)_@(hall + 1)_" />
                <label>SLOT 4</label>
                <input type="checkbox" name="detailsObjList[@index].hallsArray[@hall].slotsArray[@(slot + 3)].isSelected" id="slotcheck@(slot + 4)_@(hall + 1)_" onchange="slotcheckchange(@(slot + 4), @(hall + 1));" />

                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].slotsArray[@(slot + 4)].slotID" value="@(slot + 5)" id="hiddenslot@(slot + 5)_@(hall + 1)_" />
                <label>SLOT 5</label>
                <input type="checkbox" name="detailsObjList[@index].hallsArray[@hall].slotsArray[@(slot + 4)].isSelected" id="slotcheck@(slot + 5)_@(hall + 1)_" onchange="slotcheckchange(@(slot + 5), @(hall + 1);" />

                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].slotsArray[@(slot + 5)].slotID" value="@(slot + 6)" id="hiddenslot@(slot + 6)_@(hall + 1)_" />
                <label>SLOT 6</label>
                <input type="checkbox" name="detailsObjList[@index].hallsArray[@hall].slotsArray[@(slot + 5)].isSelected" id="slotcheck@(slot + 6)_@(hall + 1)_" onchange="slotcheckchange(@(slot + 6), @(hall + 1));" />
                <br />
            <!--REQUIREMENTS-->
                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].requirementsArray[@requirement].requirementID" value="@(requirement + 1)" id="hiddenreq@(requirement + 1)_@(hall + 1)_" />
                <label>Requirement 1</label>
                <input type="checkbox" disabled name="detailsObjList[@index].hallsArray[@hall].requirementsArray[@requirement].isSelected" id="reqcheck@(requirement + 1)_@(hall + 1)_" onchange="reqcheckchange(@(requirement + 1), @(hall + 1));" />

                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].requirementsArray[@(requirement + 1)].requirementID" value="@(requirement + 2)" id="hiddenreq@(requirement + 2)_@(hall + 1)_" />
                <label>Requirement 2</label>
                <input type="checkbox" disabled name="detailsObjList[@index].hallsArray[@hall].requirementsArray[@(requirement + 1)].isSelected" id="reqcheck@(requirement + 2)_@(hall + 1)_" onchange="reqcheckchange(@(requirement + 2), @(hall + 1));" />

                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].requirementsArray[@(requirement + 2)].requirementID" value="@(requirement + 3)" id="hiddenreq@(requirement + 3)_@(hall + 1)_" />
                <label>Requirement 3</label>
                <input type="checkbox" disabled name="detailsObjList[@index].hallsArray[@hall].requirementsArray[@(requirement + 2)].isSelected" id="reqcheck@(requirement + 3)_@(hall + 1)_" onchange="reqcheckchange(@(requirement + 3), @(hall + 1));" />

                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].requirementsArray[@(requirement + 3)].requirementID" value="@(requirement + 4)" id="hiddenreq@(requirement + 4)_@(hall + 1)_" />
                <label>Requirement 4</label>
                <input type="checkbox" disabled name="detailsObjList[@index].hallsArray[@hall].requirementsArray[@(requirement + 3)].isSelected" id="reqcheck@(requirement + 4)_@(hall + 1)_" onchange="reqcheckchange(@(requirement + 4), @(hall + 1));" />

                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].requirementsArray[@(requirement + 4)].requirementID" value="@(requirement + 5)" id="hiddenreq@(requirement + 5)_@(hall + 1)_" />
                <label>Requirement 5</label>
                <input type="checkbox" disabled name="detailsObjList[@index].hallsArray[@hall].requirementsArray[@(requirement + 4)].isSelected" id="reqcheck@(requirement + 5)_@(hall + 1)_" onchange="reqcheckchange(@(requirement + 5), @(hall + 1));" />

                <input type="hidden" name="detailsObjList[@index].hallsArray[@hall].requirementsArray[@(requirement + 5)].requirementID" value="@(requirement + 6)" id="hiddenreq@(requirement + 6)_@(hall + 1)_" />
                <label>Requirement 6</label>
                <input type="checkbox" disabled name="detailsObjList[@index].hallsArray[@hall].requirementsArray[@(requirement + 5)].isSelected" id="reqcheck@(requirement + 6)_@(hall + 1)_" onchange="reqcheckchange(@(requirement + 6), @(hall + 1));" />

                hall = hall + 1;

            }
            hall = 0; 
            <br />

            @*<input type="submit" value="Submit" />*@
            @* } *@
        @*<button id="btnAddMore" onclick="addMore(@index, @hall, @slot, @requirement);">Add more</button>*@
            @*}*@
        }
</div>
@using (Html.BeginForm("Testing", "BookUtility", FormMethod.Post))
{
    <span id="writeroot">@*<input type="submit" value="Submit" />*@</span>
    @*<button id="btnAddMore" onclick="addMore(@index, @hall, @slot, @requirement);">Add more</button>*@
    <input type="submit" value="Submit" />
 } 
<button id="btnAddMore" onclick="addMore(@index, @hall, @slot, @requirement);">Add more</button>

<script type="text/javascript">
    $(document).ready(function () {
        var detailsArray = new Array();
        detailsArray = '@Html.Raw(Json.Encode(ViewBag.HallDetail))';
        $("#date").attr("name", "detailsObjList[" + 0 + "].date");
        var newFields = document.getElementById('bookingForm').cloneNode(true);
        newFields.id = '';
        newFields.style.display = 'block';
        var newField = newFields.childNodes;
        for (var i = 0; i < newField.length; i++) {
            var newId = newField[i].id
            if (newId)
                newField[i].id = newId + click;
        }
        var insertHere = document.getElementById('writeroot');
        insertHere.parentNode.insertBefore(newFields, insertHere);
    });
    var click=0;
    var addMore = function (index, hall, slot, requirement) {
        click = click + 1;

        var newFields = document.getElementById('bookingForm').cloneNode(true);
        newFields.id = '';
        newFields.style.display = 'block';
        var newField = newFields.childNodes;
        for (var i = 0; i < newField.length; i++) {
            var newId = newField[i].id
            if (newId)
                newField[i].id = newId + click;
        }
        var insertHere = document.getElementById('writeroot');
        insertHere.parentNode.insertBefore(newFields,insertHere);
        //document.getElementById("bookingForm" + click).reset();

        var j = 1,k = 0;
        
        for (i = 1; i <= click; i++) {
            $("#date"+click).attr("name", "detailsObjList[" + i + "].date");

            for (j = 1; j <= 6; j++) {
                for (p = 1; p <= 4; p++) {
                    $("#slotcheck" + (slot + j) + "_" + (hall + p)+"_"+click).attr("name", "detailsObjList[" + (index + i) + "].hallsArray[" + hall + "].slotsArray[" + (slot + k) + "].isSelected");
                    $("#hiddenslot" + (slot + j) + "_" + (hall + p) + "_" + click).attr("name", "detailsObjList[" + (index + i) + "].hallsArray[" + hall + "].slotsArray[" + (slot + k) + "].slotID");
                    $("#reqcheck" + (requirement + j) + "_" + (hall + p) + "_" + click).attr("name", "detailsObjList[" + (index + i) + "].hallsArray[" + hall + "].requirementsArray[" + (requirement + k) + "].isSelected");
                    $("#hiddenreq" + (requirement + j) + "_" + (hall + p) + "_" + click).attr("name", "detailsObjList[" + (index + i) + "].hallsArray[" + hall + "].requirementsArray[" + (requirement + k) + "].requirementID");
                }
                k++;
            }
        }
    }
</script>


<script type="text/javascript">
    var slotcheckchange = function (slotid, hallid) {
        var id="#slotcheck"+slotid+"_"+hallid+"_"+click;
        if ($(id).prop('checked')) {
            $(id).val('true');
        }
    }
    var reqcheckchange = function (reqid, hallid) {
        var id = "#reqcheck" + reqid + "_" + hallid + "_" + click;
        if ($(id).prop('checked')) {
            $(id).val('true');
        }
    }
    var datechosen = function () {
        var id = "date"+click;
        var date = document.getElementById(id).value;
        $.ajax({
            type: "POST",
            data: { 'date': date },
            dataType: 'JSON',
            url: "/BookUtility/GetBookedSlotsList",
            success: function (bookedSlotsList) {
                var bookedSlotsItem = '';
                $.each(bookedSlotsList, function (i, bookedSlotsItem) {
                    $("#slotcheck" + bookedSlotsItem.slotID + "_" + bookedSlotsItem.hallID + "_" + click).prop("disabled", true);
                });
            }
        });
        getRequirementsList();
    }
    var getRequirementsList = function(){
        $.ajax({
            type:"GET",
            dataType: 'JSON',
            url: "/BookUtility/GetRequirementsList",
            success: function (requirementsList) {
                var requirementsItem ='';
                $.each(requirementsList,function(i, requirementsItem) {
                    $("#reqcheck" + requirementsItem.requirementID + "_" + requirementsItem.hallID + "_" + click).removeAttr("disabled");
                })
            }
        });
        //    }
        //})
    }
</script>